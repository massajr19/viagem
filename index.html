<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelShopper AI v5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .tab-active { border-bottom: 3px solid #2563eb; color: #2563eb; }
        @keyframes scanAnim { 0% { top: 0%; } 100% { top: 100%; } }
        .scan-line { position: absolute; width: 100%; height: 2px; background: #3b82f6; box-shadow: 0 0 15px #3b82f6; animation: scanAnim 2s linear infinite; }
    </style>
</head>
<body class="p-4 bg-gray-50 font-sans">

    <header class="mb-4 bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center">
        <div>
            <h1 class="text-xl font-black text-blue-600 tracking-tighter italic">TravelShopper AI</h1>
            <p id="exchangeDisplay" class="text-[10px] text-gray-400 font-bold uppercase"></p>
        </div>
        <select id="currencySelector" onchange="fetchExchangeRate()" class="p-2 border rounded-lg bg-gray-50 font-bold text-xs outline-none">
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
            <option value="JPY">JPY</option>
            <option value="QAR">QAR</option>
        </select>
    </header>

    <nav class="flex justify-around mb-4 bg-white rounded-xl shadow-sm p-2 text-[10px] font-black uppercase">
        <button id="btn-home" onclick="showPage('home')" class="py-2 px-4 tab-active">Wishlist</button>
        <button id="btn-add" onclick="showPage('add')" class="py-2 px-4 text-gray-400">Cadastrar IA</button>
        <button id="btn-scan" onclick="showPage('scan')" class="py-2 px-4 text-gray-400">Comparar</button>
    </nav>

    <div id="page-home">
        <div id="wishlistContainer" class="space-y-3"></div>
    </div>

    <div id="page-add" class="hidden">
        <div class="relative bg-black w-full h-72 rounded-3xl mb-4 overflow-hidden shadow-2xl">
            <video id="videoAdd" playsinline class="w-full h-full object-cover opacity-70"></video>
            <div class="scan-line"></div>
            <div class="absolute bottom-4 w-full flex justify-center">
                <button onclick="captureAndProcess()" class="bg-white p-4 rounded-full shadow-lg active:scale-90 transition-transform">
                    <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold">AI</div>
                </button>
            </div>
        </div>

        <div id="aiLoading" class="hidden text-center p-4">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"></div>
            <p class="text-xs font-bold text-blue-600 uppercase">IA analisando produto...</p>
        </div>

        <div id="manualForm" class="bg-white p-5 rounded-2xl shadow-md space-y-3">
            <input type="text" id="pName" placeholder="Nome do Produto" class="w-full p-3 bg-gray-50 rounded-xl border outline-none font-bold">
            <div class="grid grid-cols-2 gap-2">
                <input type="text" id="pBrand" placeholder="Fabricante" class="p-3 bg-gray-50 rounded-xl border text-xs outline-none">
                <input type="text" id="pRating" placeholder="Nota (Ex: 4.8)" class="p-3 bg-gray-50 rounded-xl border text-xs outline-none">
            </div>
            <textarea id="pSpecs" placeholder="Especificações básicas..." class="w-full p-3 bg-gray-50 rounded-xl border text-xs outline-none h-20"></textarea>
            <div class="flex items-center gap-2">
                <span class="text-xs font-black text-gray-400">R$</span>
                <input type="number" id="pPrice" placeholder="Preço BR" class="flex-1 p-3 bg-gray-50 rounded-xl border font-black text-green-600 text-lg">
            </div>
            <button onclick="saveProduct()" class="bg-blue-600 text-white w-full py-4 rounded-xl font-black shadow-lg">CONFIRMAR E SALVAR</button>
        </div>
    </div>

    <div id="page-scan" class="hidden">
        <div class="bg-black w-full h-56 rounded-3xl mb-4 overflow-hidden">
            <video id="videoScan" playsinline class="w-full h-full object-cover"></video>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow-sm border">
            <input type="text" id="scanName" list="products-list" placeholder="Qual produto?" class="w-full p-4 mb-3 bg-gray-50 rounded-xl border font-bold outline-none">
            <datalist id="products-list"></datalist>
            <div class="flex gap-2 mb-4">
                <input type="number" id="scanPrice" placeholder="Preço Local" class="flex-1 p-4 bg-gray-50 rounded-xl text-2xl font-black text-blue-600 border outline-none">
                <input type="number" id="exchangeRate" class="w-20 p-2 border rounded-xl text-xs font-bold text-center">
            </div>
            <button onclick="comparePrice()" class="bg-blue-600 text-white w-full py-5 rounded-2xl font-black shadow-xl">COMPARAR ECONOMIA</button>
        </div>
        <div id="resultArea" class="mt-4 p-6 rounded-2xl hidden shadow-2xl animate-result"></div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('wishlist')) || [];
        let currentStream = null;

        // CÂMBIO
        async function fetchExchangeRate() {
            const currency = document.getElementById('currencySelector').value;
            const res = await fetch(`https://open.er-api.com/v6/latest/${currency}`);
            const data = await res.json();
            document.getElementById('exchangeRate').value = data.rates.BRL.toFixed(4);
            document.getElementById('exchangeDisplay').innerText = `1 ${currency} = R$ ${data.rates.BRL.toFixed(2)}`;
        }

        // CÂMERA
        async function setupCamera(videoId) {
            if (currentStream) currentStream.getTracks().forEach(t => t.stop());
            try {
                currentStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                document.getElementById(videoId).srcObject = currentStream;
                document.getElementById(videoId).play();
            } catch (e) { alert("Permita o uso da câmera!"); }
        }

        function showPage(page) {
            ['home', 'add', 'scan'].forEach(p => {
                document.getElementById(`page-${p}`).classList.toggle('hidden', page !== p);
                document.getElementById(`btn-${p}`).className = page === p ? 'py-2 px-4 tab-active' : 'py-2 px-4 text-gray-400';
            });
            if(page === 'add') setupCamera('videoAdd');
            else if(page === 'scan') setupCamera('videoScan');
            else if(currentStream) currentStream.getTracks().forEach(t => t.stop());
            
            if(page === 'home') renderWishlist();
            updateDatalist();
        }

        // SIMULAÇÃO DE IA (Aqui entrará a API do Gemini posteriormente)
        function captureAndProcess() {
            document.getElementById('aiLoading').classList.remove('hidden');
            setTimeout(() => {
                // Simulação de retorno da IA
                document.getElementById('pName').value = "Sony WH-1000XM5";
                document.getElementById('pBrand').value = "Sony";
                document.getElementById('pRating').value = "4.9";
                document.getElementById('pSpecs').value = "Noise Cancelling, 30h bateria, Lançamento 2022";
                document.getElementById('pPrice').value = 2500;
                document.getElementById('aiLoading').classList.add('hidden');
            }, 2000);
        }

        function saveProduct() {
            const product = {
                name: document.getElementById('pName').value,
                brand: document.getElementById('pBrand').value,
                rating: document.getElementById('pRating').value,
                specs: document.getElementById('pSpecs').value,
                price: parseFloat(document.getElementById('pPrice').value),
                date: new Date().toLocaleDateString()
            };
            db.push(product);
            localStorage.setItem('wishlist', JSON.stringify(db));
            showPage('home');
        }

        function renderWishlist() {
            const container = document.getElementById('wishlistContainer');
            container.innerHTML = db.map((p, i) => `
                <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-blue-600 relative">
                    <button onclick="deleteItem(${i})" class="absolute right-3 top-3 text-gray-300">✕</button>
                    <p class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-1">${p.brand || 'Produto'}</p>
                    <h3 class="font-black text-gray-800 uppercase leading-tight">${p.name}</h3>
                    <p class="text-[9px] text-gray-400 my-1">${p.specs || ''}</p>
                    <div class="flex justify-between items-end mt-2">
                        <span class="bg-yellow-100 text-yellow-700 text-[9px] px-2 py-0.5 rounded font-bold">★ ${p.rating || 'N/A'}</span>
                        <p class="font-black text-blue-600">R$ ${p.price.toFixed(2)}</p>
                    </div>
                </div>
            `).join('');
        }

        function deleteItem(i) { db.splice(i, 1); localStorage.setItem('wishlist', JSON.stringify(db)); renderWishlist(); }
        function updateDatalist() { document.getElementById('products-list').innerHTML = db.map(p => `<option value="${p.name}">`).join(''); }

        function comparePrice() {
            const localPrice = parseFloat(document.getElementById('scanPrice').value);
            const rate = parseFloat(document.getElementById('exchangeRate').value);
            const match = db.find(p => p.name.toLowerCase() === document.getElementById('scanName').value.toLowerCase());
            const area = document.getElementById('resultArea');
            area.classList.remove('hidden');
            
            const converted = localPrice * rate;
            if(match) {
                const saving = match.price - converted;
                area.className = `mt-4 p-6 rounded-3xl text-white ${saving > 0 ? 'bg-green-600' : 'bg-red-600'}`;
                area.innerHTML = `<h2 class="text-4xl font-black italic">R$ ${converted.toFixed(2)}</h2>
                                 <p class="text-xs font-bold uppercase opacity-80 mt-1">${saving > 0 ? 'Economia' : 'Prejuízo'} de R$ ${Math.abs(saving).toFixed(2)}</p>`;
            } else {
                area.className = "mt-4 p-6 rounded-3xl bg-white border-2 border-blue-600 text-blue-600 text-center";
                area.innerHTML = `<h2 class="text-4xl font-black">R$ ${converted.toFixed(2)}</h2><p class="text-xs uppercase font-bold">Conversão Direta</p>`;
            }
        }

        fetchExchangeRate();
    </script>
</body>
</html>
