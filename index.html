<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TravelShopper AI v5.4</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/831/831145.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none !important; }
        .tab-active { border-bottom: 6px solid #2563eb !important; color: #2563eb !important; font-weight: 900 !important; }
        @keyframes scanAnim { 0% { top: 0%; } 100% { top: 100%; } }
        .scan-line { position: absolute; width: 100%; height: 4px; background: #3b82f6; box-shadow: 0 0 20px #3b82f6; animation: scanAnim 2s linear infinite; }
        
        /* Fontes agigantadas para leitura fÃ¡cil */
        body { font-size: 18px; }
        h1 { font-size: 28px !important; }
        input, select, button { font-size: 20px !important; min-height: 60px !important; }
        label { font-size: 14px !important; font-weight: 800; color: #64748b; text-transform: uppercase; }
        
        .btn-nav { transition: all 0.2s; -webkit-tap-highlight-color: transparent; }
        .btn-nav:active { transform: scale(0.9); background-color: #f1f5f9; }
    </style>
</head>
<body class="p-4 bg-gray-100 font-sans pb-32">

    <header class="mb-6 bg-white p-6 rounded-[2rem] shadow-lg border border-gray-200 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <img src="https://cdn-icons-png.flaticon.com/512/831/831145.png" class="w-12 h-12">
            <h1 class="font-black text-blue-600 tracking-tighter italic">TS AI</h1>
        </div>
        <div class="text-right">
            <select id="currencySelector" onchange="fetchExchangeRate()" class="p-3 border-2 border-blue-200 rounded-2xl bg-gray-50 font-black outline-none shadow-sm">
                <option value="USD">DÃ³lar $</option>
                <option value="EUR">Euro â‚¬</option>
                <option value="JPY">Iene Â¥</option>
                <option value="QAR">Rial ï·¼</option>
            </select>
        </div>
    </header>

    <nav class="flex justify-around mb-8 bg-white rounded-[1.5rem] shadow-xl p-2 sticky top-2 z-50 border-2 border-blue-50">
        <button id="btn-home" onclick="showPage('home')" class="btn-nav flex-1 py-4 font-black tab-active">Wishlist</button>
        <button id="btn-add" onclick="showPage('add')" class="btn-nav flex-1 py-4 font-black text-gray-400">Cadastrar</button>
        <button id="btn-scan" onclick="showPage('scan')" class="btn-nav flex-1 py-4 font-black text-gray-400">Comparar</button>
    </nav>

    <div id="page-home" class="space-y-4">
        <div id="wishlistContainer" class="space-y-4"></div>
    </div>

    <div id="page-add" class="hidden space-y-6">
        <div class="relative bg-black w-full h-80 rounded-[2.5rem] overflow-hidden shadow-2xl border-4 border-white">
            <video id="videoAdd" playsinline muted class="w-full h-full object-cover opacity-70"></video>
            <div class="scan-line"></div>
            <div class="absolute bottom-6 w-full flex justify-center">
                <button onclick="processImage('add')" class="bg-white p-6 rounded-full shadow-2xl active:scale-75 transition-all border-8 border-blue-100">
                    <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white text-4xl font-black">AI</div>
                </button>
            </div>
        </div>

        <div id="loadingAdd" class="hidden p-5 bg-blue-600 text-white rounded-3xl font-black text-center animate-pulse">IA ANALISANDO...</div>

        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl space-y-6 border-t-[12px] border-blue-600">
            <div>
                <label class="ml-2">Nome do Produto</label>
                <input type="text" id="pName" placeholder="Ex: iPhone 16 Pro" class="w-full p-5 bg-gray-50 rounded-2xl border-2 border-gray-100 font-black text-2xl outline-none focus:border-blue-400">
            </div>
            <div>
                <label class="ml-2 block text-right">PreÃ§o no Brasil (R$)</label>
                <input type="number" id="pPrice" placeholder="0.00" class="w-full p-6 bg-blue-50 rounded-2xl border-2 border-blue-100 font-black text-blue-700 text-4xl text-right outline-none">
            </div>
            <button onclick="saveProduct()" class="bg-blue-600 text-white w-full py-6 rounded-3xl font-black shadow-xl text-2xl uppercase tracking-tighter">Gravar na Lista</button>
        </div>
    </div>

    <div id="page-scan" class="hidden space-y-6">
        <div class="relative bg-black w-full h-80 rounded-[2.5rem] overflow-hidden shadow-2xl border-4 border-white">
            <video id="videoScan" playsinline muted class="w-full h-full object-cover"></video>
            <div class="absolute bottom-6 w-full flex justify-center">
                <button onclick="processImage('scan')" class="bg-white p-6 rounded-full shadow-2xl active:scale-75 transition-all border-8 border-green-100">
                    <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center text-white text-4xl">ðŸ’°</div>
                </button>
            </div>
        </div>

        <div id="loadingScan" class="hidden p-5 bg-green-600 text-white rounded-3xl font-black text-center animate-pulse">LENDO PREÃ‡O...</div>

        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl space-y-6">
            <input type="text" id="scanName" list="products-list" placeholder="Qual produto?" class="w-full p-5 bg-gray-50 rounded-2xl border-2 border-gray-100 font-black text-2xl outline-none">
            <datalist id="products-list"></datalist>
            
            <div class="flex gap-4">
                <div class="flex-1">
                    <label class="ml-2">PreÃ§o Local</label>
                    <input type="number" id="scanPrice" placeholder="0.00" class="w-full p-6 bg-gray-50 rounded-2xl text-4xl font-black text-blue-600 border-2 border-gray-100 outline-none">
                </div>
                <div class="w-32">
                    <label class="text-center block">CotaÃ§Ã£o</label>
                    <input type="number" id="exchangeRate" step="0.01" class="w-full p-6 border-2 border-gray-100 rounded-2xl font-black text-center text-xl bg-gray-200">
                </div>
            </div>
            <button onclick="comparePrice()" class="bg-blue-600 text-white w-full py-7 rounded-3xl font-black text-3xl shadow-2xl uppercase italic tracking-tighter">Comparar</button>
        </div>
        <div id="resultArea" class="mt-6 p-8 rounded-[2.5rem] hidden shadow-2xl animate-bounce-short"></div>
    </div>

    <footer class="mt-16 text-center pb-12">
        <div id="exchangeDisplay" class="text-sm font-bold text-gray-400 mb-4 uppercase tracking-widest">Carregando cÃ¢mbio...</div>
        <span class="bg-blue-600 text-white text-lg px-6 py-3 rounded-full font-black shadow-lg">v5.4 FINAL</span>
    </footer>

    <script>
        const GEMINI_API_KEY = "AIzaSyDXrhxr9NMQp3D9SrVQzsQy9EyYNfIqXjU"; 
        let db = JSON.parse(localStorage.getItem('wishlist')) || [];
        let currentStream = null;

        async function fetchExchangeRate() {
            const currency = document.getElementById('currencySelector').value;
            try {
                const res = await fetch(`https://open.er-api.com/v6/latest/${currency}`);
                const data = await res.json();
                document.getElementById('exchangeRate').value = data.rates.BRL.toFixed(2);
                document.getElementById('exchangeDisplay').innerText = `CÃ¢mbio: 1 ${currency} = R$ ${data.rates.BRL.toFixed(2)}`;
            } catch (e) { console.error("Erro cÃ¢mbio"); }
        }

        async function setupCamera(videoId) {
            if (currentStream) {
                currentStream.getTracks().forEach(t => t.stop());
            }
            try {
                currentStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } } 
                });
                const videoElement = document.getElementById(videoId);
                videoElement.srcObject = currentStream;
                videoElement.onloadedmetadata = () => videoElement.play();
            } catch (e) {
                alert("Por favor, autorize a cÃ¢mera no Chrome.");
            }
        }

        function showPage(page) {
            const pages = ['home', 'add', 'scan'];
            pages.forEach(p => {
                const el = document.getElementById
