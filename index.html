<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelShopper Pro v3.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .tab-active { border-bottom: 3px solid #2563eb; color: #2563eb; }
        /* Anima√ß√£o suave para os resultados */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-result { animation: fadeIn 0.4s ease-out; }
    </style>
</head>
<body class="p-4 bg-gray-50 font-sans">

    <header class="mb-6 bg-white p-4 rounded-2xl shadow-sm">
        <h1 class="text-2xl font-bold text-blue-600">TravelShopper ‚úàÔ∏è</h1>
        <div class="flex flex-col gap-2 mt-3 p-3 bg-blue-50 rounded-lg border border-blue-100">
            <label class="text-[10px] font-black text-blue-800 uppercase tracking-widest">Moeda Estrangeira (Local)</label>
            <div class="flex gap-2">
                <select id="currencySelector" onchange="fetchExchangeRate()" class="flex-1 p-2 border rounded-lg bg-white font-bold text-sm outline-none">
                    <option value="USD">D√≥lar (USD)</option>
                    <option value="EUR">Euro (EUR)</option>
                    <option value="JPY">Iene Japon√™s (JPY)</option>
                    <option value="QAR">Rial Catarense (QAR)</option>
                    <option value="GBP">Libra Esterlina (GBP)</option>
                    <option value="ARS">Peso Argentino (ARS)</option>
                    <option value="PYG">Guarani (PYG)</option>
                </select>
                <div class="relative w-32">
                    <span class="absolute left-2 top-2.5 text-[10px] text-gray-400 font-bold">R$</span>
                    <input type="number" id="exchangeRate" step="0.0001" class="w-full p-2 pl-7 border rounded-lg font-bold text-blue-900 outline-none text-sm">
                </div>
            </div>
            <div class="flex justify-between items-center mt-1">
                <span class="text-[9px] text-blue-400 italic font-medium">* Cota√ß√£o para 1 unidade da moeda.</span>
                <button onclick="fetchExchangeRate()" class="text-[10px] font-bold text-blue-700 underline">Atualizar Agora</button>
            </div>
        </div>
    </header>

    <nav class="flex justify-around mb-6 bg-white rounded-xl shadow-sm p-2 text-xs font-bold uppercase tracking-wider">
        <button id="btn-home" onclick="showPage('home')" class="py-2 px-4 tab-active transition-all">Minha Lista</button>
        <button id="btn-scan" onclick="showPage('scan')" class="py-2 px-4 text-gray-400 transition-all">Comparar Pre√ßo</button>
    </nav>

    <div id="page-home">
        <button onclick="toggleAddForm()" class="bg-blue-600 text-white w-full py-4 rounded-xl mb-4 shadow-lg font-black text-lg active:scale-95 transition-transform">+ ADICIONAR PRODUTO</button>
        
        <div id="addForm" class="hidden bg-white p-5 rounded-2xl shadow-md mb-6 border-b-4 border-blue-500 animate-result">
            <label class="block text-xs font-bold text-gray-400 mb-1 uppercase">Nome (Ex: Perfume 100ml)</label>
            <input type="text" id="pName" placeholder="O que voc√™ quer comprar?" class="w-full mb-3 p-3 bg-gray-50 rounded-xl outline-none border focus:border-blue-300">
            
            <label class="block text-xs font-bold text-gray-400 mb-1 uppercase">Pre√ßo no Brasil (R$)</label>
            <input type="number" id="pPrice" placeholder="Quanto custa no BR?" class="w-full mb-4 p-3 bg-gray-50 rounded-xl outline-none border focus:border-blue-300">
            
            <button onclick="saveProduct()" class="bg-green-500 text-white w-full py-3 rounded-xl font-bold shadow-md">SALVAR NA LISTA</button>
        </div>

        <div id="wishlistContainer" class="space-y-3">
            </div>
    </div>

    <div id="page-scan" class="hidden">
        <div class="relative bg-black w-full h-52 rounded-3xl mb-6 overflow-hidden flex items-center justify-center border-4 border-white shadow-xl">
            <div class="absolute inset-0 opacity-40 bg-[url('https://images.unsplash.com/photo-1512314889357-e157c22f938d?q=80&w=400')] bg-cover bg-center"></div>
            <div class="z-10 text-white text-center">
                <div class="border-2 border-dashed border-white/50 w-40 h-28 mx-auto mb-2 rounded-lg flex items-center justify-center">
                    <span class="text-3xl">üîç</span>
                </div>
                <p class="text-[10px] font-bold uppercase tracking-widest">Identifica√ß√£o Visual Ativa</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-3xl shadow-sm">
            <label class="block text-[10px] font-black text-gray-400 mb-1 uppercase tracking-tighter">Produto (Busca na Wishlist)</label>
            <input type="text" id="scanName" list="products-list" placeholder="O que voc√™ est√° vendo?" class="w-full p-4 mb-4 bg-gray-50 rounded-xl border-2 border-transparent focus:border-blue-500 outline-none font-bold">
            <datalist id="products-list"></datalist>

            <label class="block text-[10px] font-black text-gray-400 mb-1 uppercase tracking-tighter text-right">Pre√ßo na Etiqueta</label>
            <div class="relative">
                <span id="currencySymbol" class="absolute left-4 top-4 font-bold text-gray-400 text-xl">$</span>
                <input type="number" id="scanPrice" placeholder="0.00" class="w-full p-4 pl-12 mb-6 bg-gray-50 rounded-xl text-3xl font-black text-blue-600 outline-none">
            </div>
            
            <button onclick="comparePrice()" class="bg-blue-600 text-white w-full py-5 rounded-2xl font-black text-xl shadow-xl active:scale-95 transition-transform">CALCULAR COMPARATIVO</button>
        </div>
        
        <div id="resultArea" class="mt-8 p-6 rounded-3xl hidden shadow-2xl animate-result"></div>
    </div>

    <script>
        // Mem√≥ria do App (Estruturada)
        let db = JSON.parse(localStorage.getItem('wishlist')) || [];
        const symbols = { 
            USD: '$', EUR: '‚Ç¨', JPY: '¬•', QAR: 'Ô∑º', 
            GBP: '¬£', ARS: '$', PYG: '‚Ç≤' 
        };

        // Fun√ß√£o para Buscar C√¢mbio via API Externa
        async function fetchExchangeRate() {
            const currency = document.getElementById('currencySelector').value;
            document.getElementById('currencySymbol').innerText = symbols[currency];
            
            try {
                // API p√∫blica e gratuita para taxas de c√¢mbio
                const response = await fetch(`https://open.er-api.com/v6/latest/${currency}`);
                const data = await response.json();
                const rate = data.rates.BRL;
                document.getElementById('exchangeRate').value = rate.toFixed(4);
            } catch (error) {
                console.error("Erro na API de C√¢mbio. Verifique a internet.");
            }
        }

        // Navega√ß√£o entre abas
        function showPage(page) {
            document.getElementById('page-home').classList.toggle('hidden', page !== 'home');
            document.getElementById('page-scan').classList.toggle('hidden', page !== 'scan');
            document.getElementById('btn-home').className = page === 'home' ? 'py-2 px-4 tab-active' : 'py-2 px-4 text-gray-400';
            document.getElementById('btn-scan').className = page === 'scan' ? 'py-2 px-4 tab-active' : 'py-2 px-4 text-gray-400';
            updateDatalist();
        }

        function toggleAddForm() { 
            document.getElementById('addForm').classList.toggle('hidden'); 
        }

        // INSERT (Salvar Produto)
        function saveProduct() {
            const name = document.getElementById('pName').value.trim();
            const price = document.getElementById('pPrice').value;
            
            if(name && price) {
                db.push({ name: name, price: parseFloat(price) });
                localStorage.setItem('wishlist', JSON.stringify(db));
                renderWishlist();
                toggleAddForm();
                document.getElementById('pName').value = '';
                document.getElementById('pPrice').value = '';
            } else {
                alert("Preencha nome e pre√ßo!");
            }
        }

        // Atualiza as sugest√µes de pesquisa
        function updateDatalist() {
            const list = document.getElementById('products-list');
            list.innerHTML = db.map(item => `<option value="${item.name}">`).join('');
        }

        // Exibe a lista na tela
        function renderWishlist() {
            const container = document.getElementById('wishlistContainer');
            if(db.length === 0) {
                container.innerHTML = '<div class="text-center py-10 opacity-30 font-bold italic">Nenhum produto salvo</div>';
                return;
            }
            container.innerHTML = db.map((item, index) => `
                <div class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border-r-8 border-blue-400">
                    <div>
                        <p class="font-black text-gray-800 uppercase text-xs">${item.name}</p>
                        <p class="text-xs text-blue-500 font-bold">BR: R$ ${item.price.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                    </div>
                    <button onclick="deleteItem(${index})" class="text-gray-200 hover:text-red-500 font-bold p-2">‚úï</button>
                </div>
            `).join('');
        }

        function deleteItem(index) {
            if(confirm("Remover item?")) {
                db.splice(index, 1);
                localStorage.setItem('wishlist', JSON.stringify(db));
                renderWishlist();
            }
        }

        // L√≥gica de Compara√ß√£o Procedural
        function comparePrice() {
            const typedName = document.getElementById('scanName').value;
            const localPrice = parseFloat(document.getElementById('scanPrice').value);
            const rate = parseFloat(document.getElementById('exchangeRate').value);
            
            if(!localPrice) return alert("Digite o pre√ßo estrangeiro!");

            const priceInBRL = localPrice * rate;
            const match = db.find(i => i.name.toLowerCase() === typedName.toLowerCase());
            const resArea = document.getElementById('resultArea');
            resArea.classList.remove('hidden');

            if (match) {
                const diff = match.price - priceInBRL;
                const isGood = diff > 0;
                resArea.className = `mt-8 p-6 rounded-3xl animate-result ${isGood ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`;
                resArea.innerHTML = `
                    <p class="text-xs font-black uppercase mb-1 tracking-widest">${isGood ? 'üí° Vale a Compra' : '‚úã Melhor no Brasil'}</p>
                    <p class="text-4xl font-black">R$ ${priceInBRL.toFixed(2)}</p>
                    <p class="text-sm opacity-80 mt-1">Pre√ßo no Brasil: R$ ${match.price.toFixed(2)}</p>
                    <div class="mt-4 pt-4 border-t border-white/20">
                        <p class="text-xl">${isGood ? 'Voc√™ poupa' : 'Diferen√ßa de'} <b>R$ ${Math.abs(diff).toFixed(2)}</b></p>
                    </div>
                `;
            } else {
                resArea.className = 'mt-8 p-6 rounded-3xl bg-white border-2 border-blue-600 text-blue-900 animate-result shadow-xl';
                resArea.innerHTML = `
                    <p class="text-xs font-black uppercase text-blue-400 tracking-tighter">Convers√£o Simples</p>
                    <p class="text-4xl font-black">R$ ${priceInBRL.toFixed(2)}</p>
                    <p class="text-[10px] mt-2 italic text-gray-500 leading-tight">Dica: Se voc√™ cadastrar "${typedName}" na wishlist, eu comparo para voc√™.</p>
                `;
            }
        }

        // Inicializa√ß√£o
        fetchExchangeRate();
        renderWishlist();
    </script>
</body>
</html>
