<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelShopper Pro v4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .tab-active { border-bottom: 3px solid #2563eb; color: #2563eb; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-result { animation: fadeIn 0.3s ease-out; }
        video { transform: scaleX(1); } /* Para n√£o espelhar a c√¢mera traseira */
    </style>
</head>
<body class="p-4 bg-gray-50 font-sans">

    <header class="mb-6 bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
        <h1 class="text-2xl font-black text-blue-600 tracking-tighter italic">TravelShopper</h1>
        <div class="flex flex-col gap-2 mt-3 p-3 bg-blue-50 rounded-xl">
            <div class="flex gap-2">
                <select id="currencySelector" onchange="fetchExchangeRate()" class="flex-1 p-2 border rounded-lg bg-white font-bold text-sm">
                    <option value="USD">D√≥lar (USD)</option>
                    <option value="EUR">Euro (EUR)</option>
                    <option value="JPY">Iene (JPY)</option>
                    <option value="QAR">Rial Catarense (QAR)</option>
                    <option value="GBP">Libra (GBP)</option>
                </select>
                <input type="number" id="exchangeRate" step="0.0001" class="w-24 p-2 border rounded-lg font-bold text-blue-900 text-sm">
            </div>
            <p id="lastUpdate" class="text-[9px] text-blue-400 font-medium">Cota√ß√£o atualizada automaticamente</p>
        </div>
    </header>

    <nav class="flex justify-around mb-6 bg-white rounded-xl shadow-sm p-2 text-xs font-black uppercase">
        <button id="btn-home" onclick="showPage('home')" class="py-2 px-4 tab-active">Wishlist</button>
        <button id="btn-scan" onclick="showPage('scan')" class="py-2 px-4 text-gray-400">Comparar</button>
    </nav>

    <div id="page-home">
        <button onclick="toggleAddForm()" class="bg-blue-600 text-white w-full py-4 rounded-xl mb-4 shadow-lg font-black tracking-widest">+ NOVO ITEM</button>
        
        <div id="addForm" class="hidden bg-white p-5 rounded-2xl shadow-md mb-6 border-b-4 border-blue-500 animate-result">
            <label class="block text-[10px] font-black text-gray-400 mb-1 uppercase">Nome do Produto</label>
            <div class="flex gap-2 mb-3">
                <input type="text" id="pName" placeholder="Ex: iPhone 16" class="flex-1 p-3 bg-gray-50 rounded-xl outline-none border focus:border-blue-300">
                <button onclick="autoSearchPrice()" class="bg-orange-100 text-orange-600 px-3 rounded-xl text-xs font-bold border border-orange-200">üîç Buscar Pre√ßo</button>
            </div>
            
            <label class="block text-[10px] font-black text-gray-400 mb-1 uppercase tracking-widest text-right">Pre√ßo no Brasil (R$)</label>
            <input type="number" id="pPrice" placeholder="0.00" class="w-full mb-4 p-3 bg-gray-50 rounded-xl outline-none border focus:border-blue-300 font-bold text-right text-green-600 text-xl">
            
            <button onclick="saveProduct()" class="bg-blue-600 text-white w-full py-3 rounded-xl font-black shadow-md">CONFIRMAR CADASTRO</button>
        </div>

        <div id="wishlistContainer" class="space-y-3"></div>
    </div>

    <div id="page-scan" class="hidden">
        <div id="camera-container" class="relative bg-black w-full h-64 rounded-3xl mb-6 overflow-hidden flex items-center justify-center border-4 border-white shadow-xl">
            <video id="video" playsinline class="w-full h-full object-cover"></video>
            <div class="absolute inset-0 border-2 border-white/30 m-12 rounded-lg pointer-events-none"></div>
        </div>

        <div class="bg-white p-6 rounded-3xl shadow-sm">
            <input type="text" id="scanName" list="products-list" placeholder="Nome do produto..." class="w-full p-4 mb-4 bg-gray-50 rounded-xl border focus:border-blue-500 outline-none font-bold">
            <datalist id="products-list"></datalist>

            <div class="relative">
                <span id="currencySymbol" class="absolute left-4 top-4 font-bold text-gray-400 text-xl">$</span>
                <input type="number" id="scanPrice" placeholder="Pre√ßo Local" class="w-full p-4 pl-12 mb-6 bg-gray-50 rounded-xl text-3xl font-black text-blue-600 outline-none">
            </div>
            
            <button onclick="comparePrice()" class="bg-blue-600 text-white w-full py-5 rounded-2xl font-black text-xl shadow-xl active:scale-95 transition-transform">COMPARAR AGORA</button>
        </div>
        
        <div id="resultArea" class="mt-8 p-6 rounded-3xl hidden shadow-2xl animate-result"></div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('wishlist')) || [];
        const symbols = { USD: '$', EUR: '‚Ç¨', JPY: '¬•', QAR: 'Ô∑º', GBP: '¬£' };
        let stream = null;

        // BUSCA AUTOM√ÅTICA DE PRE√áOS (Conveni√™ncia)
        function autoSearchPrice() {
            const name = document.getElementById('pName').value;
            if (!name) return alert("Digite o nome do produto primeiro!");
            // Abre o Google Shopping Brasil em uma nova aba para o usu√°rio ver o pre√ßo real
            const searchUrl = `https://www.google.com.br/search?q=pre√ßo+${encodeURIComponent(name)}&tbm=shop`;
            window.open(searchUrl, '_blank');
            alert("Verifique o menor pre√ßo na aba que abriu e digite o valor no campo abaixo.");
        }

        // C√ÇMBIO AUTOM√ÅTICO
        async function fetchExchangeRate() {
            const currency = document.getElementById('currencySelector').value;
            document.getElementById('currencySymbol').innerText = symbols[currency];
            try {
                const response = await fetch(`https://open.er-api.com/v6/latest/${currency}`);
                const data = await response.json();
                document.getElementById('exchangeRate').value = data.rates.BRL.toFixed(4);
                document.getElementById('lastUpdate').innerText = "Cota√ß√£o atualizada agora";
            } catch (e) { console.error("Erro c√¢mbio"); }
        }

        // CONTROLE DA C√ÇMERA
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                const video = document.getElementById('video');
                video.srcObject = stream;
                video.play();
            } catch (err) {
                console.error("Erro c√¢mera: ", err);
                document.getElementById('camera-container').innerHTML = "<p class='text-white p-4 text-center text-xs'>Permita o acesso √† c√¢mera nas configura√ß√µes do navegador.</p>";
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        }

        function showPage(page) {
            document.getElementById('page-home').classList.toggle('hidden', page !== 'home');
            document.getElementById('page-scan').classList.toggle('hidden', page !== 'scan');
            document.getElementById('btn-home').className = page === 'home' ? 'py-2 px-4 tab-active' : 'py-2 px-4 text-gray-400';
            document.getElementById('btn-scan').className = page === 'scan' ? 'py-2 px-4 tab-active' : 'py-2 px-4 text-gray-400';
            
            if (page === 'scan') startCamera(); else stopCamera();
            updateDatalist();
        }

        // CRUD B√ÅSICO
        function toggleAddForm() { document.getElementById('addForm').classList.toggle('hidden'); }

        function saveProduct() {
            const name = document.getElementById('pName').value.trim();
            const price = document.getElementById('pPrice').value;
            if(name && price) {
                db.push({ name, price: parseFloat(price) });
                localStorage.setItem('wishlist', JSON.stringify(db));
                renderWishlist();
                toggleAddForm();
                document.getElementById('pName').value = '';
                document.getElementById('pPrice').value = '';
            }
        }

        function renderWishlist() {
            const container = document.getElementById('wishlistContainer');
            container.innerHTML = db.length === 0 ? '<p class="text-center py-10 opacity-30 italic">Sua lista est√° vazia</p>' : 
            db.map((item, index) => `
                <div class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border-l-4 border-blue-600">
                    <div>
                        <p class="font-black text-gray-800 uppercase text-[10px] leading-tight">${item.name}</p>
                        <p class="text-sm font-bold text-blue-600">R$ ${item.price.toFixed(2)}</p>
                    </div>
                    <button onclick="deleteItem(${index})" class="text-gray-300 px-2 text-xl font-light">√ó</button>
                </div>
            `).join('');
        }

        function deleteItem(index) {
            db.splice(index, 1);
            localStorage.setItem('wishlist', JSON.stringify(db));
            renderWishlist();
        }

        function updateDatalist() {
            const list = document.getElementById('products-list');
            list.innerHTML = db.map(item => `<option value="${item.name}">`).join('');
        }

        function comparePrice() {
            const typedName = document.getElementById('scanName').value;
            const localPrice = parseFloat(document.getElementById('scanPrice').value);
            const rate = parseFloat(document.getElementById('exchangeRate').value);
            
            if(!localPrice) return alert("Insira o pre√ßo local");

            const priceInBRL = localPrice * rate;
            const match = db.find(i => i.name.toLowerCase() === typedName.toLowerCase());
            const resArea = document.getElementById('resultArea');
            resArea.classList.remove('hidden');

            if (match) {
                const diff = match.price - priceInBRL;
                const isGood = diff > 0;
                resArea.className = `mt-8 p-6 rounded-3xl animate-result ${isGood ? 'bg-green-600 text-white' : 'bg-red-600 text-white'} shadow-xl`;
                resArea.innerHTML = `
                    <p class="text-[10px] font-black uppercase mb-1 tracking-widest">${isGood ? '‚úÖ Vale a Compra!' : '‚ùå T√° caro!'}</p>
                    <p class="text-4xl font-black">R$ ${priceInBRL.toFixed(2)}</p>
                    <p class="text-xs opacity-80 mt-1">Pre√ßo no Brasil: R$ ${match.price.toFixed(2)}</p>
                    <div class="mt-4 pt-4 border-t border-white/20">
                        <p class="text-xl font-bold">${isGood ? 'Voc√™ poupa' : 'Diferen√ßa de'} R$ ${Math.abs(diff).toFixed(2)}</p>
                    </div>
                `;
            } else {
                resArea.className = 'mt-8 p-6 rounded-3xl bg-white border-2 border-blue-600 text-blue-900 shadow-xl';
                resArea.innerHTML = `
                    <p class="text-xs font-black uppercase text-blue-400">Convers√£o Direta</p>
                    <p class="text-4xl font-black">R$ ${priceInBRL.toFixed(2)}</p>
                    <p class="text-[10px] mt-2 italic text-gray-500">Dica: Cadastre este produto para comparar economias.</p>
                `;
            }
        }

        fetchExchangeRate();
        renderWishlist();
    </script>
</body>
</html>
